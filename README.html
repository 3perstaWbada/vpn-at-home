<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>OpenVPN&#64;Home</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="openvpn-home">
<h1 class="title"><a class="reference external" href="mailto:OpenVPN&#64;Home">OpenVPN&#64;Home</a></h1>

<div class="section" id="legal-mumbo-jumbo">
<h1>Legal mumbo-jumbo</h1>
<p>Â© 2002-2018 OpenVPN Inc.
OpenVPN is a registered trademark of OpenVPN  Inc.</p>
<p>This project is not endorsed by, sponsored or affiliated with OpenVPN Inc.</p>
</div>
<div class="section" id="tl-dr">
<h1>TL;DR</h1>
<p>OpenVPN PKI stuff with <strong>Vue.js</strong>, <strong>Semantic UI</strong> and <strong>Django</strong>.
And with love, of course.</p>
<img alt="home.png" class="align-center" src="home.png" style="width: 512px;" />
<img alt="onboarding.png" class="align-center" src="onboarding.png" style="width: 512px;" />
<p>Feedback and pull requests are welcome.</p>
</div>
<div class="section" id="brief">
<h1>Brief</h1>
<p>Managing OpenVPN with PKI authentication is hard. Managing anything beyond hello-world using <tt class="docutils literal"><span class="pre">easy-rsa</span></tt> package
is a major issue - I could never maintain a config for more than a day. Other solutions are too <em>&quot;enterprise&quot;</em>
for a personal installation or were designed for a tin-foil hat, crypto maniacs hiding from NSA/GCHQ.</p>
<p>This app provides easy management console to keep OpenVPN configuration files in one place, provided in self-contained,
easily deployable, clickable package. It's not designed for security - it's meant just to be <strong>good enough</strong>.</p>
<p>And that works for me better than &quot;no VPN at all&quot;.</p>
<p>Features:</p>
<ol class="arabic simple">
<li>users with admin/casual privilege separation</li>
<li>simple user registration</li>
<li>automatic generation of OpenVPN profiles</li>
<li>all crypto stuff is inlined into OpenVPN profiles</li>
<li>profiles can be sent by e-mail or downloaded as files</li>
<li>Ansible scripts to automatically deploy configured VPN server</li>
<li>Tested on DigitalOcean's Ubuntu 18.04 droplet</li>
</ol>
<p>That's all folks. No fancy stuff. It's not a toolbox, it's a screwdriver to manage 3-5 home machines (and phones).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a work-in-progress app, hacked together during x-mas break to solve a specific need of mine.
Feel free to submit PRs with improvements.</p>
</div>
</div>
<div class="section" id="project-structure">
<h1>Project structure</h1>
<p>The project is split into <em>backend</em>, <em>frontend</em>. and <em>ansible</em> scripts.</p>
<p>The backend is written in <strong>Django</strong> and <strong>Django REST Framework</strong>. The frontend is a <strong>Vue.js</strong> SPA application served by <strong>Django</strong>.
That division makes the build slightly more complicated, but provided <em>Makefiles</em> make it a breeze. It should just work.</p>
<p><strong>Ansible</strong> is a set of scripts to deploy OpenVPN automatically either on localhost or remote machine.</p>
<p>Scripts located in <strong>bin</strong> are created either to automate and facilitate various tasks or provide a glue.
All scripts have internal documentation.</p>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<div class="section" id="prerequisites">
<h2>Prerequisites</h2>
<ol class="arabic simple">
<li>Working Node.js installation (tested with 9.2.1 &amp; 9.3.0)</li>
<li>Python 3 with virtualenv</li>
<li>GNU Make (or compatible)</li>
<li>Ansible (tested with 2.5.0, but no fancy functionality is used)</li>
<li>OpenVPN in ${PATH}</li>
<li>OpenSSL in ${PATH}</li>
<li>Internet connection (no off-line build possible)</li>
</ol>
</div>
<div class="section" id="deployment">
<h2>Deployment</h2>
<div class="section" id="for-development">
<h3>For development</h3>
<p>After cloning the repository, you can deploy the app for development
with a single command:</p>
<pre class="literal-block">
$ git clone https://github.com/ezaquarii/openvpn-at-home
$ cd openvpnathome
$ make devel
... backend is bootstrapped ...
... frontend is bootstrapped ...
$ make runserver
</pre>
<p>Open <tt class="docutils literal"><span class="pre">http://localhost:8001/</span></tt> and you should be able to log-in.</p>
</div>
<div class="section" id="for-production">
<h3>For production</h3>
<p>Production deployment is supported on <em>Ubuntu</em>. <em>Debian</em> should be supported, but I didn't test it there.</p>
<pre class="literal-block">
$ make deb
$ make install_deb
</pre>
<p>Open <tt class="docutils literal"><span class="pre">http://localhost:8000</span></tt> and follow on-boarding tutorial.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Building <tt class="docutils literal">deb</tt> package calls <tt class="docutils literal">make distclean</tt>, which will zap your development
configuration. Build outside devel environment if you want to preserve your config.</p>
</div>
<p>The package needs virtually zero configuration:</p>
<ul class="simple">
<li><tt class="docutils literal">deb</tt> is self-deployable</li>
<li>installs into <tt class="docutils literal">/srv/openvpnathome</tt> (referred to as <tt class="docutils literal">${ROOT}</tt>)</li>
<li>Python3 virtual environment, static files, etc are all in the <tt class="docutils literal">deb</tt> package</li>
<li><tt class="docutils literal">systemd</tt> service script <tt class="docutils literal">openvpnathome.service</tt> is installed and starts by default</li>
<li><tt class="docutils literal">uwsgi</tt> runs on <tt class="docutils literal"><span class="pre">http://127.0.0.1:8000</span></tt></li>
<li>Contains bootstrapping script to automate app configuration (<tt class="docutils literal"><span class="pre">${ROOT}/bin/bootstrap.sh</span></tt>)</li>
</ul>
<p>Building a package will call <tt class="docutils literal">sudo</tt> and ask you for a password. Root privileges are required
in Python's virtual environment installation step, as we must <tt class="docutils literal">sudo mount <span class="pre">-o</span> bind ...</tt> and
<tt class="docutils literal">sudo umount ...</tt> virtualenv destination directory. Unfortunately, Python 3 virtualenv
relocation is not reliable (and discouraged), so we decided to hack during the build process
rather than at runtime. Refer to <tt class="docutils literal">Makefile</tt> <tt class="docutils literal">install</tt> target.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <tt class="docutils literal">make deb</tt> fails for whatever reason, make sure <tt class="docutils literal">/srv/openvpnathome</tt> is left unmounted.</p>
</div>
</div>
<div class="section" id="openvpn-server-deployment">
<h3>OpenVPN server deployment</h3>
<p>Once the app is up and running, you can log in as admin (using credentials set during bootstrapping phase) and
create your server.</p>
<p>After a server is configured, you can deploy it using provided <strong>Ansible</strong> scripts. Beware that <em>Ansible</em> will modify
the target system!</p>
<ol class="arabic simple">
<li>required packages will be installed</li>
<li>iptables rules will be altered (using Uncomplicated FireWall - <tt class="docutils literal">UFW</tt>)</li>
<li>IPv4 forwarding will be enabled (using <tt class="docutils literal">sysctl.conf</tt>)</li>
</ol>
<p>It is advised to deploy the server on a remote machine, but you can do it on localhost too. I personally test it
on DigitalOcean's droplet.</p>
<pre class="literal-block">
# ${ROOT}/bin/deploy_vpn.sh [local|remote]
</pre>
<p>Supplying <tt class="docutils literal">local</tt> will deploy the server on localhost. <tt class="docutils literal">remote</tt> will try to deploy on a remote machine
using the address provided during configuration.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This feature is work-in-progress.</p>
</div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>If <tt class="docutils literal">make devel</tt> was run, the app is up and running in development mode with default development
configuration:</p>
<ul class="simple">
<li>Admin login is <em>admin&#64;locahost</em></li>
<li>Admin password is <em>admin1234</em></li>
<li>Database is located in <tt class="docutils literal"><span class="pre">${PROJECT_ROOT}/db/db.sqlite3</span></tt></li>
<li>Settings have <tt class="docutils literal">development</tt> flag set to true <tt class="docutils literal">true</tt></li>
</ul>
<div class="section" id="app-config">
<h3>App config</h3>
<p>Configuration is loaded from <tt class="docutils literal">settings.json</tt> located in deployment directory. The settings file is generated
during a bootstrap stage, so there is no need to generate it manually. However, should you need to generate the
script during development, you can do it with a supplied Django management command:</p>
<pre class="literal-block">
$ ${ROOT}/bin/manage configure [--accept] [--devel] [--help] [--force]
</pre>
<p>Once the file is generated (ie. after bootstrap), you must review and accept it by flipping the <tt class="docutils literal">configured</tt> flag inside.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal">settings.json</tt> is excluded from Git repository, so you can safely put your real e-mail credentials there
during development.</p>
</div>
<p>You can also access <strong>Django Admin</strong> app, which is left enabled.</p>
</div>
<div class="section" id="openvpn-config">
<h3>OpenVPN config</h3>
<p>OpenVPN configuration is generated from templates in <tt class="docutils literal">openvpnathome.apps.openvpn.templates</tt>. If the default
configuration doesn't suit your needs, you can alter templates directly there.</p>
<p>There is no frontend config editor, although I was thinking about it.</p>
</div>
</div>
</div>
<div class="section" id="development">
<h1>Development</h1>
<p>Want to jump in? Fantastic.</p>
<p>I made it as easy to start development as possible. Top-level project directory contains 2 subprojects:
<tt class="docutils literal">backend</tt> and <tt class="docutils literal">frontend</tt>.</p>
<p>Top-level <tt class="docutils literal">Makefile</tt> delegates targets to sub-projects and is provided for convenience. Once <tt class="docutils literal">make devel</tt> is
done, you can work inside individual subproject with your favourite IDE.</p>
<p>I personally use <em>JetBrains WebStorm</em> and <em>PyCharm</em>, but you can use whatever you want.
IDE files are not even in the repo.</p>
<div class="section" id="backend-subproject">
<h2>Backend subproject</h2>
<p>This is the <strong>Django</strong> app. Mostly REST API + single frontend serving view.
App modules have brief documentation inside <tt class="docutils literal">__init__.py</tt>. Docs are kept up-to-date, as I strongly
believe in code documentation.</p>
<p>Provided <tt class="docutils literal">Makefile</tt>'s default target displays help:</p>
<pre class="literal-block">
$ make
Welcome to OpenVPN&#64;Home make system

Available targets:
 * devel      - boostrap project for development (your first choice)
 * virtualenv - install virtual environment and all dependencies
 * runserver  - start development server
 * test       - run full test suite
</pre>
<p>In development mode, frontend files are stored outside of this project, in <tt class="docutils literal">frontend</tt> subproject. <strong>Django</strong> app
will pick static and templates from frontend build directory.</p>
<p>When development mode is off, frontend resources are taken from <tt class="docutils literal">openvpnathome.apps.frontend</tt> app.</p>
<p><strong>Django Debug Toolbar</strong> is provided by default, should you need to check which templates are picked up.</p>
</div>
<div class="section" id="frontend-subproject">
<h2>Frontend subproject</h2>
<p>Frontend sub-project contains <strong>Vue.js</strong> SPA served by <strong>Django</strong>.</p>
<p>Provided <tt class="docutils literal">Makefile</tt>'s default target displays help:</p>
<pre class="literal-block">
$ cd frontend
$ make
Welcome to OpenVPN&#64;Home make system - frontend sub-project
You need running node.js and npm.

Available targets:
 * build-prod  - build production build; backend project is NOT updated
 * build-devel - watch and make development build on change; output is written to './dist'
 * install     - install packages from package.json
 * distclean   - clean project, delete all data (start from 'git clone' state)
</pre>
<p>This is pretty self-explanatory too. When developing front-end code, you run <strong>Django</strong> app in development mode,
and <tt class="docutils literal">make <span class="pre">build-devel</span></tt>.</p>
<p><strong>Django</strong> will pick frontend code from <tt class="docutils literal">frontend/dist</tt> directory.</p>
<p><strong>Django</strong> injects some initial state via <tt class="docutils literal"><span class="pre">&lt;script&gt;...&lt;/script&gt;</span></tt> tag. See <tt class="docutils literal">index.html</tt> and <tt class="docutils literal">openvpnathome.apps.frontent.views</tt> for
details.</p>
</div>
</div>
<div class="section" id="licence">
<h1>Licence</h1>
<p>GNU GPL v3.</p>
</div>
<div class="section" id="known-issues">
<h1>Known issues</h1>
<p>I left this as the last point, hoping not to scare anybody.</p>
<blockquote>
<ul class="simple">
<li>only one sever can be managed (I don't need more for now)</li>
<li>frontend has 0% test coverage and many lint issues :o)</li>
<li>security is not a major concern for this app, I'm not running a CA company</li>
<li>no real user management - I rely on Django Admin panel for it</li>
<li>not tested on Windows, as I don't touch it even with a 10-foot stick, in rubber gloves - patches are welcome, however</li>
<li>no cert revocation (yet)</li>
<li>strike: no automatic OpenVPN configuration- Ansible script is provided</li>
</ul>
</blockquote>
</div>
</div>
</body>
</html>
